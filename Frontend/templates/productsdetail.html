{% extends "base.html" %} {% load static %} {% block content %}

<div class="container mt-5">
  <!-- Product Title & Breadcrumb -->
  <div class="row">
    <div class="col-12 mb-3">
      <h3 class="fw-bold text-dark mt-5">{{ products_details.name }}</h3>
      <hr class="text-secondary" />
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="{% url 'collection' %}" class="text-decoration-none"
              >Collections</a
            >
          </li>
          <li class="breadcrumb-item">
            <a
              href="{% url 'collectionview' products_details.category.name %}"
              class="text-decoration-none"
            >
              {{ products_details.category.name }}
            </a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">
            {{ products_details.name }}
          </li>
        </ol>
      </nav>
    </div>
  </div>

  <div class="row align-items-start">
    <!-- Product Image -->
    <div class="col-md-5 text-center position-relative">
      {% if products_details.trending %}
      <span class="badge bg-danger position-absolute top-0 start-0 m-3"
        >ðŸ”¥ Trending</span
      >
      {% endif %}
      <img
        src="{{ products_details.product_image.url }}"
        alt="{{ products_details.name }}"
        class="img-fluid rounded shadow-sm border"
        style="max-height: 350px; object-fit: cover"
      />
    </div>

    <!-- Product Info -->
    <div class="col-md-7">
      <h4 class="fw-bold text-success">
        {{ products_details.name }}
        <button id="book" class="btn btn-sm btn-outline-danger ms-2">
          <i class="bi bi-bookmark-heart"></i>
        </button>
      </h4>

      <p class="text-muted mb-1">
        Vendor: <span class="fw-semibold">{{ products_details.vendor }}</span>
      </p>

      <p class="small text-secondary">{{ products_details.description }}</p>

      <!-- Pricing -->
      <div class="my-3">
        <p class="mb-1 text-danger fw-bold">
          <s>â‚¹{{ products_details.original_price|stringformat:'d' }}</s>
        </p>
        <p class="mb-2 text-primary fw-bold fs-5">
          â‚¹{{ products_details.selling_price|stringformat:'d' }}
        </p>
      </div>

      <!-- Quantity & Buttons -->
      <div>
        {% if products_details.quantity > 0 %}
        <!-- Quantity Selector -->
        <div class="input-group mb-3" style="width: 160px">
          <button class="btn btn-success" id="minus">â€“</button>
          <input
            type="number"
            min="1"
            max="10"
            id="tqty"
            name="qty"
            value="1"
            readonly
            class="form-control text-center"
          />
          <button class="btn btn-success" id="plus">+</button>
        </div>

        <!-- Cart & Order -->
        <form
          method="POST"
          action="{% url 'add_to_cart' products_details.id %}"
          class="d-inline"
        >
          {% csrf_token %}
          <input type="hidden" name="qty" id="hiddenQty" value="1" />
          <button class="btn btn-primary px-4 me-2" type="submit">
            <i class="bi bi-cart3"></i> Add to Cart
          </button>
        </form>

        <form method="POST" action="{% url 'place_order' %}" class="d-inline">
          {% csrf_token %}
          <input
            type="hidden"
            name="product_id"
            value="{{ products_details.id }}"
          />
          <input type="hidden" name="qty" id="orderQty" value="1" />
          <button class="btn btn-warning px-4" type="submit">Order</button>
        </form>
        {% else %}
        <button class="btn btn-secondary px-4" disabled>
          <i class="bi bi-x-circle"></i> Out of Stock
        </button>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Custom Styling -->
<style>
  .btn-primary:hover {
    background-color: #004a99;
  }
  .btn-outline-danger:hover {
    background-color: #dc3545;
    color: #fff;
  }
</style>

<!-- Quantity Script -->
<script>
  let minus = document.getElementById("minus");
  let plus = document.getElementById("plus");
  let q = document.getElementById("tqty");
  let hiddenQty = document.getElementById("hiddenQty");
  let orderQty = document.getElementById("orderQty");

  minus.onclick = () => {
    q.stepDown();
    hiddenQty.value = q.value;
    if (orderQty) orderQty.value = q.value;
  };
  plus.onclick = () => {
    q.stepUp();
    hiddenQty.value = q.value;
    if (orderQty) orderQty.value = q.value;
  };
</script>

<!-- Favorite toggle (client-side) -->
<script>
  const bookBtn = document.getElementById("book");
  if (bookBtn) {
    bookBtn.addEventListener("click", function (e) {
      e.preventDefault();
      const icon = this.querySelector("i");
      if (!icon) return;
      // Toggle filled/outline bookmark-heart icon
      if (icon.classList.contains("bi-bookmark-heart-fill")) {
        icon.classList.remove("bi-bookmark-heart-fill");
        icon.classList.add("bi-bookmark-heart");
        this.classList.remove("btn-danger");
        this.classList.add("btn-outline-danger");
      } else {
        icon.classList.remove("bi-bookmark-heart");
        icon.classList.add("bi-bookmark-heart-fill");
        this.classList.remove("btn-outline-danger");
        this.classList.add("btn-danger");
      }
    });
  }
</script>

{% endblock content %}
